language: objective-c
os: osx
osx_image: xcode10.2
sudo: true
rvm:
  - 2.5.3
before_install:
  - gem update --system
  - gem install bundler
cache:
  bundler: true
  directories:
  - .build # Swift Package Manager packages
env:
  global:
  - TRAVIS_CI=TRUE
  - NOKOGIRI_USE_SYSTEM_LIBRARIES=true
  matrix:
    include:
    - name: "iOS Unit Tests"
      script: bundle exec fastlane test --env ios
    - name: "macOS Unit Tests"
      script: bundle exec fastlane test --env macos
    - name: "tvOS Unit Tests"
      script: bundle exec fastlane test --env tvos
    - name: "Deliveralbe Linting"
      script: bundle exec pod lib lint --allow-warnings --verbose
      script: swift build -c release --verbose;
    - name: "Code Coverage"
      before_install:
        - sudo apt-get install jq
        - curl $(curl https://api.github.com/repos/codacy/codacy-coverage-reporter/releases/latest | jq -r '.assets | map({content_type, browser_download_url} | select(.content_type | contains("application/x-java-archive"))) | .[0].browser_download_url') -o codacy-coverage-reporter-assembly.jar
      script: bundle exec fastlane code_coverage --env ios
